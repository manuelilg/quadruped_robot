<?xml version="1.0"?>
<robot name="quadruped_robot" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:include filename="./quadruped_robot_inertial.urdf.xacro"/>
    <!--<xacro:include filename="$(find rospackage)/path"/>-->

    <link name="body_link">
        <visual>
            <origin xyz="0 0 0.00215" rpy="0 0 0"/>
            <geometry>
                <box size="0.074 0.074 0.0043"/>
            </geometry>
        </visual>
        <collison>
            <origin xyz="0 0 0.00215" rpy="0 0 0" />
            <geometry>
                <box size="0.074 0.074 0.00.0043"/>
            </geometry>
        </collison>
        <xacro:body_inertial/>
    </link>

    <!-- left and right foreleg -->
    <xacro:leg leg_nr="LF" reflect_fh="1" reflect_lr="1"/>
    <xacro:leg leg_nr="RF" reflect_fh="1" reflect_lr="-1"/>
    <!-- left and right hindleg -->
    <xacro:leg leg_nr="RH" reflect_fh="-1" reflect_lr="1"/>
    <xacro:leg leg_nr="LH" reflect_fh="-1" reflect_lr="-1"/>

    <xacro:macro name="leg" params="leg_nr leg_name_prefix:=Leg- reflect_fh reflect_lr">
        <xacro:property name="leg_name" value="${leg_name_prefix}${leg_nr}"/>
        <!-- hip abduction/adduction joint -->
        <joint name="${leg_name}-HAA_joint" type="revolute">
            <parent link="body_link"/><!--<parent link="${parent}"/>-->
            <child link="${leg_name}-Hip_link"/>
            <origin xyz="${reflect_fh * 0.033} ${reflect_lr * 0.033} -0.02275"
                rpy="${-3*pi/4 + pi/4 * reflect_fh * reflect_lr} ${pi/2} ${(1 - reflect_lr) * pi/2}"/>
            <axis xyz="1 0 0"/>
            <dynamics damping="0.00001"/>
            <limit lower="0.0" upper="${pi/2}" velocity="1.0" effort="0.0"/>
            <!-- <calibration rising_and_or_falling=""/> -->
        </joint>

        <!-- xacro link name here for reuse in selfCollide reference -->
        <link name="${leg_name}-Hip_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <box size="0.005 0.005 0.005"/>
                </geometry>
            </visual>
            <collison>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <box size="0.005 0.005 0.005"/>
                </geometry>
            </collison>
            <xacro:hip_inertial/>
        </link>

        <gazebo reference="${leg_name}-Hip_link">
            <selfCollide>true</selfCollide>
        </gazebo>

        <xacro:servo name_suffix="${leg_name}-HAA" parent="${leg_name}-Hip_link"
            xyz="-0.02275 0 0" rpy="${pi/2 - pi/2 * reflect_lr * reflect_fh} 0 ${pi}"/>

        <xacro:servo name_suffix="${leg_name}-HFE" parent="${leg_name}-Hip_link"
            xyz="0 ${-0.012  * reflect_lr * reflect_fh} 0.02275"
            rpy="${pi/2 - pi/2 * reflect_lr * reflect_fh} 0 ${-pi/2 * reflect_lr * reflect_fh}"/>

        <!-- hip flexion/extension joint -->
        <joint name="${leg_name}-HFE_joint" type="revolute">
            <parent link="${leg_name}-Hip_link"/>
            <child link="${leg_name}-Thigh_link"/>
            <origin xyz="0 ${-0.012 * reflect_lr * reflect_fh} 0.02275"
                rpy="${-pi/2} 0 ${-pi/2 * reflect_lr * reflect_fh}"/>
            <axis xyz="1 0 0"/>
            <dynamics damping="0.00001"/>
            <limit lower="0.0" upper="${pi}" velocity="1.0" effort="0.0"/>
            <!-- <calibration rising_and_or_falling=""/> -->
        </joint>

        <link name="${leg_name}-Thigh_link">
            <visual>
                <origin xyz="0 0 0.0275" rpy="0 0 0"/>
                <geometry>
                    <box size="0.005 0.01 0.055"/>
                </geometry>
            </visual>
            <collison>
                <origin xyz="0 0 0.0275" rpy="0 0 0" />
                <geometry>
                    <box size="0.005 0.01 0.055"/>
                </geometry>
            </collison>
            <xacro:thigh_inertial/>
        </link>

        <gazebo reference="${leg_name}-Thigh_link">
            <selfCollide>true</selfCollide>
        </gazebo>

        <!-- knee flexion/extension joint -->
        <joint name="${leg_name}-KFE_joint" type="revolute">
            <parent link="${leg_name}-Thigh_link"/>
            <child link="${leg_name}-Shank_link"/>
            <origin xyz="-0.012 0 0.055" rpy="${pi/2 + pi/2 * reflect_fh * reflect_lr} 0 0"/>
            <axis xyz="1 0 0"/>
            <dynamics damping="0.00001"/>
            <limit lower="0.0" upper="${pi}" velocity="1.0" effort="0.0"/>
            <!-- <calibration rising_and_or_falling=""/> -->
        </joint>

        <link name="${leg_name}-Shank_link">
            <visual>
                <origin xyz="0 0 0.04" rpy="0 0 0"/>
                <geometry>
                    <box size="0.0043 0.01 0.08"/>
                </geometry>
            </visual>
            <collison>
                <origin xyz="0 0 0.04" rpy="0 0 0" />
                <geometry>
                    <box size="0.0043 0.01 0.08"/>
                </geometry>
            </collison>
            <xacro:shank_inertial/>
        </link>

        <xacro:servo name_suffix="${leg_name}-KFE" parent="${leg_name}-Shank_link"
            xyz="0.012 0 0"
            rpy="${-pi/2} 0 0"/>

        <gazebo reference="${leg_name}-Shank_link">
            <selfCollide>true</selfCollide>
        </gazebo>

    </xacro:macro>

    <xacro:macro name="servo" params="name_suffix parent xyz rpy">
        <xacro:property name="servo_name_prefix" value="servo-${name_suffix}"/>
        <joint name="${servo_name_prefix}_joint" type="fixed">
            <parent link="${parent}"/>
            <child link="${servo_name_prefix}_link"/>
            <origin xyz="${xyz}" rpy="${rpy}"/>
            <!--<axis xyz="1 0 0"/>
            <dynamics damping="0.00001"/>
            <limit lower="0.0" upper="${pi}" velocity="1.0" effort="0.0"/>-->
        </joint>
        <link name="${servo_name_prefix}_link">
            <visual>
                <origin xyz="${-(0.0215/2 + 0.0077)} -0.007 0 " rpy="0 0 0"/>
                <geometry>
                    <box size="0.0215 0.024 0.012"/>
                </geometry>
            </visual>
            <collison>
                <origin xyz="${-(0.0215/2 + 0.0077)} -0.007 0 " rpy="0 0 0"/>
                <geometry>
                    <box size="0.0215 0.024 0.012"/>
                </geometry>
            </collison>
            <xacro:servo_inertial/>
        </link>
        <gazebo reference="${leg_name}-Hip_link">
            <selfCollide>true</selfCollide>
        </gazebo>
    </xacro:macro>


    <gazebo reference="body_link">
        <selfCollide>true</selfCollide>
    </gazebo>

</robot>
